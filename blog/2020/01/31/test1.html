<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    Yet Another Stylised Water Shader - Half Past Yellow | Blog
    
  </title>

  <meta name="description" content="We&#39;re still hard at work on our as-yet unannounced project here at Half Past Yellow, but we&#39;ve already had some folks asking about how I put together the sty...">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/blog/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/blog/assets/vendor/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/blog/assets/main.css">
  <link rel="canonical" href="https://halfpastyellow.com/blog/2020/01/31/test1.html">
  <link rel="alternate" type="application/rss+xml" title="Half Past Yellow | Blog" href="/blog/feed.xml">

</head>


<body style="background-color: #fff2000a">

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/blog/">Half Past Yellow | Blog</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="https://halfpastyellow.com">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/">Blog</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://halfpastyellow.com/press">Presskit</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->
  
  <header class="masthead" style="background-image: url('/blog/img/posts/1/header.png')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>Yet Another Stylised Water Shader</h1>
            
            <h2 class="subheading">A semi-realistic reactive water shader breakdown</h2>
            
            <span class="meta">Posted by
              <a href="https://twitter.com/R3mzo">Remy</a>
              on January 31, 2020 &middot; <span class="reading-time" title="Estimated read time">
  
   9 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container" style="background-color: white">
    <div class="row">
      <div class="col-lg-10 col-md-10 mx-auto" >

        <p>
We're still hard at work on our as-yet unannounced project here at Half Past Yellow, but we've already had some folks asking about how I put together the stylised water shader shown in this here tweet:
<blockquote class="twitter-tweet tw-align-center" data-theme="light"><p lang="en" dir="ltr">Yet another stylised water shader.<a href="https://twitter.com/hashtag/screenshotsaturday?src=hash&amp;ref_src=twsrc%5Etfw">#screenshotsaturday</a> <a href="https://twitter.com/hashtag/madewithunity?src=hash&amp;ref_src=twsrc%5Etfw">#madewithunity</a> <a href="https://twitter.com/hashtag/gamedev?src=hash&amp;ref_src=twsrc%5Etfw">#gamedev</a> <a href="https://twitter.com/hashtag/indiedev?src=hash&amp;ref_src=twsrc%5Etfw">#indiedev</a> <a href="https://twitter.com/hashtag/unity3d?src=hash&amp;ref_src=twsrc%5Etfw">#unity3d</a> <a href="https://t.co/WGkM2CRtIU">pic.twitter.com/WGkM2CRtIU</a></p>&mdash; Remy Stuurwold (@R3mzo) <a href="https://twitter.com/R3mzo/status/1251463311503360011?ref_src=twsrc%5Etfw">April 18, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</P>

<p>
We wanted something different from the common cel-shaded stylised toon water look so we developed this semi-realistic, 'in-between' water visual for our game. The aim of this post is not necessarily a tutorial but to give a conceptual overview of how you could use some or all of these techniques to accomplish something similar.
</p>
<p>
The entire effect is comprised of several distinct features that come together to sell the look and feel of cool, refreshing water that still fits with our game's art style. Some of these features are based in reality while others are complete artistic liberty and we think the interplay between these two concepts makes for a playful, fresh and interesting visual that matches the overall tone of the game.
</P>

<p>
We are using Unity as our engine of choice, and I personally prefer manually tinkering with the shader code, but the concepts outlined here should be generally applicable in any game engine or shader tool. The water object itself is simply a plane that intersects the terrain with the shader applied. It's a bit of a long post so without further ado, let's get to it! 
</p>

<h2 class="section-heading">Color and Light Absorption</h2>
<p>
Color seems like a good place to start. There are a bunch of tricks I'm doing here to keep it looking somewhat convincing while providing us with a lot of control. We're still using a physically-based lighting calculation with Smoothness and Metallic values to get that realistic vibe so we plug in some blue Albedo to kick us off. This will be our <i>Surface Color</i>.
</p>
<div class="text-center">
<img class="img-fluid bordered" src="https://halfpastyellow.com/blog/img/posts/1/albedo.png" alt="Demo Image">
</div>
<span class="caption text-muted">What a fantastic start.</span>

<p>
Mmmm, blue... In order to make it look a little less like plastic and a little more like water, we need to be able to see through it! To do this, I'm grabbing the screen space texture before the water is rendered as well as the depth texture which we will need very shortly.
</p>

<p>
If we ignore the physically based shading and simply sample the pre-water texture and multiply it by the water color to get the underwater color we would get this:
</p>

<div class="text-center">
<img class="img-fluid bordered" src="https://halfpastyellow.com/blog/img/posts/1/simpleTint2.png" alt="Demo Image">
</div>
<span class="caption text-muted">More watery, but we can do a lot better.</span>

<p>
 To get it looking more realistic, we need to tint the color of everything underwater by how much water is between it and the surface. Conceptually, color in the real world exists because the object absorbs all light of other wavelengths and reflects back only the frequencies of light that we perceive as its color. We use this concept to absorb more of the inverse water color from the pre-water color the more water there is between the bottom and the surface at that point from the camera's perspective. Oof, that sentence is <i>dense</i>. Let's go through it.
</p>

<p>
First, I take the inverse of the water color, which I'll call the <i>Absorption Color</i>. Then, I calculate the <i>Absorption Value</i> which controls how much color absorption there is. The <i>Absorption Value</i> is calculated from the view-space depth difference between the surface and the bottom of the pool. This depth value can be kept linear or squared to get different absorption falloffs. For some creative control, I am also multiplying the depth by a tweak value I call <i>Absorption Strength</i>. I then multiply the <i>Absorption Color</i> by this calculated <i>Absorption Value</i> to get what I call the <i>Subtractive Color</i>.
</p>
<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp">	<span class="n">fixed3</span> <span class="n">absorptionColor</span> <span class="p">=</span> <span class="p">(</span><span class="nf">float3</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)-</span><span class="n">_Color</span><span class="p">);</span>
	<span class="kt">float</span> <span class="n">absorptionVal</span> <span class="p">=</span> <span class="m">1.0</span> <span class="p">-</span> <span class="p">((</span><span class="nf">exp2</span><span class="p">(-</span><span class="n">_AbsorptionStrength</span> <span class="p">*</span> <span class="n">depthVal</span><span class="p">)));</span>

	<span class="n">float3</span> <span class="n">subtractiveColor</span> <span class="p">=</span> <span class="n">absorptionColor</span> <span class="p">*</span> <span class="n">absorptionVal</span><span class="p">;</span></code></pre></figure>

<p>
If we were to render the <i>Subtractive Color</i> now, this is what we get:
</p>

<div class="text-center">
<img class="img-fluid bordered" src="https://halfpastyellow.com/blog/img/posts/1/fantasea.png" alt="Demo Image">
</div>
<span class="caption text-muted">Is this the real life?</span>

<p>
It's orange. Surely this is the opposite of what we want - correct! Let's now take the color sampled from the screen texture and subtract the <i>Subtractive Color</i> from it. What we will get is the absorbed color of everthing under the surface based on how deep the water is from the camera's perspective. Here I am also playing with the <i>Absorption Strength</i> tweak value:
</p>
<div class="text-center">
  <video class="video-fluid bordered" autoplay loop controls muted src="https://halfpastyellow.com/blog/img/posts/1/underwater.mp4" type ="video/mp4"></>
</div> 
<span class="caption text-muted">Now we're getting somewhere!</span>

<p>
Note how we still get some of the brighter areas of the ground texture coming through in areas of higher absorption giving the whole thing a bit more visual depth and interest.
</p>

<p>
We're almost there now. It can look pretty dark at high <i>Absorption Strength</i> values so let's now add this underwater color to the <i>Surface Color</i> we already have. A little bit of tweaking and <b>BOOM</b> we finally get the look we want!
</p>
<div class="text-center">
<img class="img-fluid bordered" src="https://halfpastyellow.com/blog/img/posts/1/finalcolor.png" alt="Demo Image">
</div>
<span class="caption text-muted">Not too shabby.</span>

<p>
Now that we've got the base color done, this is a good foundation to add the next few features of our water. Of course we're not limited with rendering just water in this way. With different colors and tweak values we're able to represent as many questionable liquids as we'd like!
</p>
<div class="text-center">
  <video class="video-fluid bordered" autoplay loop controls muted src="https://halfpastyellow.com/blog/img/posts/1/questionablecolors.mp4" type ="video/mp4"></>
</div> 

<h2 class="section-heading">Surface Normals and Refraction</h2>
<p>
I followed these Catlike Coding tutorials pew pew
</p>
<h2 class="section-heading">Depth Foam</h2>
<p>
Depth foam is i) linear band and ii) scrolling noise textures.
</p>
<h2 class="section-heading">Caustics</h2>
<p>
Caustics are scrolling textures, modulated by underwater normal, projected straight down in world space, colored by light color.
</p>
<h2 class="section-heading">Dynamic Flow</h2>
<p>
Dynamic flow is 
</p>
<h2 class="section-heading">Possible Future Additions</h2>
<p>
A couple features we could consider adding at this point to fancy it up a bit more without deviating too much from the overall art style are:
 <ul>
	<li>Surface Displacement</li>
	<li>Underwater Volumetric Shadows</li>
 </ul>
</p>

<p>
As with all the other features, these would simply be added to the shader and be independently tweakable to complement what we have already. I could spend many more weeks tinkering and fiddling but we've reached a point where we're quite happy with the result for now - there's a lot more to be done on the game after all!
</p>

<p>I hope this was a good general overview of how we achieved this particular look for the water. Let us know if this was informative and you'd like to see more of this in the future or if you have any other comments on how we gone done did this. There's a lot more to come so be sure to hit us up on our socials to stay connected!
</p>

        <hr style="margin-top: 2rem">

        <div class="clearfix">

          
          
          <a class="btn btn-primary float-right" href="/blog/2020/07/01/test6.html" data-toggle="tooltip" data-placement="top" title="This is a title 6">Next<span class="d-none d-md-inline">
              Post</span> &rarr;</a>
          
        </div>
		  
		  <hr>
		  
      </div>
    </div>
  </div>


  <!-- Footer -->

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
		<div class="container" style="max-width: 80px">
			<img class="img-fluid" src="https://halfpastyellow.com/blog/img/hpycircle_white.png"></>
		</div>
		<h4 class="text-center">Stay in touch!</h2>
        <ul class="list-inline text-center">
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/halfpastyellow">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://www.facebook.com/HalfPastYellow">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://discord.gg/GFJvqrR">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-discord fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          		  
        </ul>
        <p class="copyright text-muted">Copyright &copy; Half Past Yellow 2020</p>
      </div>
    </div>
  </div>
</footer>


  <script src="/blog/assets/vendor/jquery/jquery.min.js"></script>
<script src="/blog/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/blog/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/blog/assets/scripts.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXXX-X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-XXXXXXXXX-X');
</script>



</body>

</html>
